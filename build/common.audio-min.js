!function(o){if("function"==typeof define&&define.amd){var t=[];define("common.audio",t,o)}else"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=o:o(window._,window.Backbone)}(function(){function o(o,t,e){this.context=o,this.urlList=t,this.onload=e,this.bufferList=[],this.loadCount=0}try{window.AudioContext=window.AudioContext||window.webkitAudioContext,context=new AudioContext}catch(t){log("Web Audio API is not supported in this browser")}var e=function(o,t){return context?(t&&(this.options=r.extend(this.options,t)),o&&this.load(o),void 0):(r.log("ERROR: No AudioContext available. Try Chrome, Safari of Firefox Nightly."),void 0)};e.prototype.load=function(t,e){if(t){e=e||function(){};var n,u,f=[],a={};if(t instanceof Array){f=t;for(var d in t)n=t[d],u=r.pathToName(n),a[u]=n}else if(t instanceof Object){for(var c in t)f.push(t[c]);a=t}else n=t,u=r.pathToName(n),f.push(n),a[u]=n;var s=new o(context,f,new i(a,e));s.load()}},e.prototype.options={},e.prototype.play=function(o){if(!n[o])return r.log("no audio loaded with the key:"+o);if(!n[o].buffer)return r.log("audio has not loaded yet");var t=context.createBufferSource();t.buffer=n[o].buffer,t.connect(context.destination),t.start(0)};var n={},i=function(o){return this.collection=o,n=r.extend(n,this.collection),this.update.bind(this)};i.prototype.update=function(o){for(var t in this.collection){var e=this.collection[t],i=this.toIndex(t);n[t]={file:e,buffer:o[i]}}},i.prototype.toIndex=function(o){var t=0;for(var e in this.collection){if(e==o)break;t++}return t},o.prototype.loadBuffer=function(o,t){var e=new XMLHttpRequest;e.open("GET",o,!0),e.responseType="arraybuffer";var n=this;e.onload=function(){n.context.decodeAudioData(e.response,function(e){return e?(n.bufferList[t]=e,++n.loadCount==n.urlList.length&&n.onload(n.bufferList),void 0):(r.log("error decoding file data: "+o),void 0)},function(o){r.log("decodeAudioData error: "+o)})},e.onprogress=function(){},e.onerror=function(){r.log("BufferLoader: XHR error")},e.send()},o.prototype.load=function(){for(var o=0;o<this.urlList.length;++o)this.loadBuffer(this.urlList[o],o)};var r={log:function(o){console.log(o)},extend:function(o,t){for(var e in t)t[e]&&t[e].constructor&&t[e].constructor===Object?(o[e]=o[e]||{},arguments.callee(o[e],t[e])):o[e]=t[e];return o},pathToName:function(o){var t;return t=o.replace(/^.*[\\\/]/,""),t=t.substring(0,t.lastIndexOf("."))}};return"object"==typeof window&&"object"==typeof window.document&&(window.CommonAudio=e),e});